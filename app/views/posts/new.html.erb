<div class="container-fluid">
  <!-- navbar -->
  <%= render 'shared/navbar' %>
  <hr />

  <%= form_for @post, :url => {:action => 'create'} do |f| %>
    <div class="row">
      <div class="col-12 form-group">
        <label>title</label>
        <%= f.text_field :title, class: "form-control", placeholder: "Compose new micropost..." %>
        <p class="text-danger">
          <%= @post.errors.messages[:title][0] if @post.errors.messages[:title].any? %>
        </p>
      </div>
      <div class="col-12 form-group">
        <label>content</label>
        <%= f.text_area :content, class: "form-control", placeholder: "Compose new micropost..." %>
        <p class="text-danger">
          <%= @post.errors.messages[:content][0] if @post.errors.messages[:content].any? %>
        </p>
      </div>
      <div class="col-12 form-group">
        <label>url</label>
        <%= f.text_field :url, class: "form-control", placeholder: "Compose new micropost..." %>
        <p class="text-danger">
          <%= "URLを入力してください" if @post.errors.messages[:url].any? %>
        </p>
      </div>

      <%= image_tag "noimage.png", :id => "image_preview", :size =>'300x300' %>

      <div class="col-12">
        <span class="image">
          <%= f.file_field :image, id: :post_image, accept: 'image/jpeg, image/png, image/jpg'  %>
        </span>
        <p class="text-danger">
          <%= @post.errors.messages[:image][0] if @post.errors.messages[:image].any? %>
        </p>
      </div>

      <div class="col-12 mt-3 mb-5">
        <%= f.submit "Post", class: "btn btn-primary" %>
      </div>
    </div>

  <% end %>

</div>

<script type="text/javascript">
  $('#post_image').bind('change', function() {
    var size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 1) {
      alert('Maximum file size is 1MB. Please choose a smaller file.');
    }
  });
</script>
<script type="text/javascript">
  $(function() {
   function readURL(input) {
     if (input.files && input.files[0]) {
       var reader = new FileReader();
       reader.onload = function (e) {
         $('#image_preview').attr('src', e.target.result);
       }
       reader.readAsDataURL(input.files[0]);
     }
   }
   $("#post_image").change(function(){
     readURL(this);
   });
  });
</script>
